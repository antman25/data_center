---
- name: "vault.yml"
  hosts: localhost
  gather_facts: yes
  become: yes
  tasks:
  - name: Remove docker if installed from CentOS repo
    yum:
      name:
        - docker
        - docker-client
        - docker-client-latest
        - docker-common
        - docker-latest
        - docker-latest-logrotate
        - docker-logrotate
        - docker-engine
      state: removed
  - name: Add Docker repo
      get_url:
        url: https://download.docker.com/linux/centos/docker-ce.repo
        dest: /etc/yum.repos.d/docer-ce.repo
      become: yes
  - name: Install packages (RedHat)
    dnf:
      name: "{{ packages }}"
      state: latest
    vars:
      packages:
        - docker-ce
        - docker-ce-cli
        - containerd.io
    when: ansible_os_family == "RedHat"
  - name: Enable service docker
    service:
      name: docker
      enabled: yes